var g=(c,s,e)=>new Promise((u,a)=>{var b=d=>{try{v(e.next(d))}catch(p){a(p)}},w=d=>{try{v(e.throw(d))}catch(p){a(p)}},v=d=>d.done?u(d.value):Promise.resolve(d.value).then(b,w);v((e=e.apply(c,s)).next())});import{Z as R,r as P,c as y,z as I,Q as T,$ as V,o,g as U,w as _,e as l,b as n,d as t,X as m,q as h,t as k,u as i,f,M as $,P as E,k as j,l as H}from"./index.92312bcf.js";import{H as N}from"./Header.2bdb63fd.js";import{F as O}from"./Footer.bdb453cc.js";import{F as Y}from"./FileUploader.10c4677f.js";import{a as A}from"./DateUtils.561c33b0.js";import{h as S}from"./moment.40bc58bf.js";R([]);P(0);function G(c){return new Promise((s,e)=>{y({method:"GET",url:"non_profit.non_profit.custom_doctype.payment_entry.get_donation_payment_entry",params:{dt:"Donation",dn:c},onSuccess:a=>{console.log("Payment data prepared:",a),s(a),K(a).then(s).catch(e)},onError:a=>{console.error("Error fetching payment entry data:",a),e(a)}}).reload()})}function K(c){return new Promise((s,e)=>{y({method:"POST",url:"non_profit.api.fundraising.add_donation_payment_entry",params:{payment_entry:c},onSuccess:a=>{s(a)},onError:a=>{e(a)}}).reload()})}const q={key:0,class:"w-full h-48 bg-gray-300 animate-pulse"},z={key:1,class:"w-full h-auto"},L={class:"thanks-section text-center mx-2"},Q=t("h1",null,"Kirim Bukti Transfermu",-1),X=t("p",null,"Kirim bukti transfer untuk memverifikasi donasimu",-1),Z=t("h1",null,"Menunggu Verifikasi",-1),J=t("p",null,"Donasi Anda sedang diverifikasi oleh admin kami",-1),W=t("h1",null,"Terimakasih",-1),ee=t("p",null,"Donasi Anda telah kami terima dan akan segera disalurkan",-1),te={class:"border rounded-lg border-gray-900 mx-2 my-6 p-4 shadow-gray-700 shadow-lg"},ae={class:"grid grid-cols-2 mb-2"},oe=t("div",null,"Tanggal:",-1),ne={class:"pl-10"},se={class:"grid grid-cols-2 mb-2"},ie=t("div",null,"Metode Pembayaran:",-1),re={class:"pl-10"},de={class:"grid grid-cols-2 mb-2"},le=t("div",null,"Status:",-1),ce={class:"pl-10"},ue={class:"flex justify-between mx-16 my-8"},_e=t("div",null,"Total Donasi",-1),me={class:"font-bold"},fe={key:0,class:"flex justify-between mx-16 m-8"},ve=["src"],pe={key:1,class:"flex justify-between mx-16 m-8"},he=t("div",null,"Sertakan Bukti Transfer",-1),ye={key:2},ge={key:0},ke={key:1},Re={__name:"DonationDetail",setup(c){S.locale("id");const s=I(),e=P({}),u=P(!0),a=T("$user"),b=T("$session"),w=r=>{},v=r=>g(this,null,function*(){y({method:"POST",url:"non_profit.api.fundraising.upload_evidence",params:{donation_id:s.currentRoute.value.params.id,evidence:r.file_url},transform(D){console.log(D)}}).reload(),window.location.reload()}),d=()=>g(this,null,function*(){y({method:"POST",url:"non_profit.api.fundraising.submit_donation",params:{donation_id:s.currentRoute.value.params.id},transform(x){console.log(x)}}).reload(),window.location.reload()}),p=()=>g(this,null,function*(){G(s.currentRoute.value.params.id).then(r=>{console.log("Payment Entry Created: ",r)}).catch(r=>{console.error("Failed to create payment entry: ",r)})}),B=y({method:"GET",url:"non_profit.api.fundraising.get_donation_by_id",auto:!0,realtime:!0,params:{donation_id:s.currentRoute.value.params.id},transform(r){e.value=r,u.value=!1}});return V(()=>{B.reload(),e.creation=S(e.creation).format("D MMMM YYYY HH:mm")}),(r,x)=>(o(),U(i(H),null,{default:_(()=>[l(N,{showBackButton:!0}),l(i(j),null,{default:_(()=>[u.value?(o(),n("div",q)):(o(),n("div",z,[t("div",L,[e.value.evidance_of_transfer?e.value.docstatus===0&&e.value.evidance_of_transfer?(o(),n(m,{key:1},[Z,J],64)):e.value.docstatus===1&&e.value.evidance_of_transfer?(o(),n(m,{key:2},[W,ee],64)):h("",!0):(o(),n(m,{key:0},[Q,X],64))]),t("div",te,[t("div",ae,[oe,t("div",ne,k(i(A)(e.value.creation)),1)]),t("div",se,[ie,t("div",re,k(e.value.mode_of_payment),1)]),t("div",de,[le,t("div",ce,[e.value.evidance_of_transfer?e.value.docstatus===0&&e.value.evidance_of_transfer?(o(),n(m,{key:1},[f(" Menunggu verifikasi ")],64)):e.value.docstatus===1&&e.value.evidance_of_transfer?(o(),n(m,{key:2},[f(" Donasi berhasil ")],64)):h("",!0):(o(),n(m,{key:0},[f(" Menunggu bukti transfer ")],64))])])]),t("div",ue,[_e,t("div",me,"Rp. "+k(e.value.amount),1)]),e.value.evidance_of_transfer?(o(),n("div",fe,[t("img",{src:e.value.evidance_of_transfer,alt:"Preview Image",style:{"max-width":"200px","max-height":"200px"}},null,8,ve)])):(o(),n("div",pe,[he,t("div",null,[l(i(Y),{fileTypes:["image/*"],validateFile:w,onSuccess:v},{default:_(({file:D,uploading:F,progress:M,uploaded:be,message:we,error:xe,total:Pe,success:De,openFileSelector:C})=>[l(i($),{onClick:C,loading:F},{default:_(()=>[f(k(F?`Uploading ${M}%`:"Upload Image"),1)]),_:2},1032,["onClick","loading"])]),_:1})])])),i(b).isLoggedIn&&i(a).data&&i(a).data.roles&&i(a).data.user_type==="System User"?(o(),n("div",ye,[e.value.evidance_of_transfer&&e.value.docstatus===0?(o(),n("div",ge,[l(i(E),{expand:"block",onClick:d},{default:_(()=>[f("Validasi Donasi")]),_:1})])):h("",!0),e.value.docstatus===1&&e.value.item_type==="Uang"?(o(),n("div",ke,[l(i(E),{expand:"block",onClick:p},{default:_(()=>[f("Buat Entry")]),_:1})])):h("",!0)])):h("",!0)]))]),_:1}),l(O)]),_:1}))}};export{Re as default};
